# **ADR-0005** Security Vulnerability Scanning Tools

**Author**: @pfouilloux

![Accepted](https://img.shields.io/badge/status-accepted-success) ![Date](https://img.shields.io/badge/Date-06_Mar_2025-lightblue)

## Context and Problem Statement

As we develop our application, we need to ensure that we identify and address security vulnerabilities early in the development lifecycle. This requires implementing appropriate security scanning tools for both our Rust backend and TypeScript/React frontend, as well as our dependencies.

We need to determine which security vulnerability scanning tools to integrate into our CI/CD pipeline to provide comprehensive coverage across our technology stack.

## Decision Drivers

* Coverage for both Rust and TypeScript/React codebases
* Integration with our CI/CD pipeline
* Ability to detect vulnerabilities in dependencies
* Support for detecting common security issues (OWASP Top 10)
* False positive rate
* Performance impact on CI/CD pipeline
* Developer experience and feedback loop
* License compatibility
* Community support and maintenance

## Considered Options

* Manual security reviews only
* Dependency scanning only (cargo audit, npm audit)
* Static Application Security Testing (SAST) tools only
* Combination of dependency scanning and SAST tools
* Commercial security scanning platforms

## Decision Outcome

Chosen option: "Combination of dependency scanning and SAST tools", because it provides comprehensive coverage across our technology stack while maintaining a reasonable balance between security, performance, and developer experience.

### Consequences

* Good, because we can detect vulnerabilities in both our code and dependencies
* Good, because we can integrate these tools into our existing CI/CD pipeline
* Good, because we can customize the scanning rules to reduce false positives
* Good, because we can leverage open-source tools with strong community support
* Bad, because it requires maintenance of multiple tools
* Bad, because it may increase CI/CD pipeline execution time

## Pros and Cons of the Options

### Manual security reviews only

* Good, because it leverages human expertise to identify complex vulnerabilities
* Good, because it avoids false positives from automated tools
* Good, because it can be tailored to the specific codebase
* Bad, because it is time-consuming and not scalable
* Bad, because it is prone to human error and inconsistency
* Bad, because it depends on the availability of security expertise

### Dependency scanning only (cargo audit, npm audit)

* Good, because it identifies vulnerabilities in third-party dependencies
* Good, because it is easy to integrate into CI/CD pipelines
* Good, because it has minimal performance impact
* Bad, because it doesn't detect vulnerabilities in our own code
* Bad, because it may miss vulnerabilities that aren't in public databases
* Bad, because it may report vulnerabilities that don't affect our usage

### Static Application Security Testing (SAST) tools only

* Good, because it can identify vulnerabilities in our own code
* Good, because it can detect a wide range of security issues
* Good, because it can be customized to our coding patterns
* Bad, because it may have a high false positive rate
* Bad, because it doesn't detect vulnerabilities in dependencies
* Bad, because it may have a significant performance impact

### Combination of dependency scanning and SAST tools

* Good, because it provides comprehensive coverage of both code and dependencies
* Good, because it leverages the strengths of different tools
* Good, because it can be integrated into different stages of the CI/CD pipeline
* Good, because it allows for customization and tuning
* Bad, because it requires maintenance of multiple tools
* Bad, because it may increase CI/CD pipeline execution time

### Commercial security scanning platforms

* Good, because they often provide comprehensive coverage
* Good, because they typically include regular updates and support
* Good, because they may offer additional features like vulnerability prioritization
* Bad, because they can be expensive
* Bad, because they may not integrate well with our specific technology stack
* Bad, because they may introduce vendor lock-in

## More Information

### Implementation Details

**For Rust Backend**

1. **Dependency Scanning**
   - **cargo-audit**: Scans Cargo.lock files for known vulnerabilities
   ```bash
   cargo install cargo-audit
   cargo audit
   ```

2. **SAST Tools**
   - **cargo-geiger**: Detects usage of unsafe Rust code
   ```bash
   cargo install cargo-geiger
   cargo geiger
   ```
   - **clippy**: Linter that includes security-related lints
   ```bash
   rustup component add clippy
   cargo clippy -- -D warnings
   ```

**For TypeScript/React Frontend**

1. **Dependency Scanning**
   - **npm audit**: Scans package-lock.json for known vulnerabilities
   ```bash
   npm audit
   ```
   - **Snyk**: More comprehensive dependency scanning
   ```bash
   npm install -g snyk
   snyk test
   ```

2. **SAST Tools**
   - **ESLint with security plugins**: Static analysis for JavaScript/TypeScript
   ```bash
   npm install eslint-plugin-security
   ```
   - **SonarQube/SonarCloud**: More comprehensive static analysis

**CI/CD Integration**

```yaml
# GitHub Actions workflow example
name: Security Scanning

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  rust-security:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: Install Rust
        uses: actions-rs/toolchain@v1
        with:
          profile: minimal
          toolchain: stable
          override: true
          components: clippy
      
      - name: Dependency audit
        uses: actions-rs/audit-check@v1
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
      
      - name: Clippy check
        uses: actions-rs/clippy-check@v1
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          args: -- -D warnings
  
  js-security:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '18'
      
      - name: Install dependencies
        run: npm ci
      
      - name: Run npm audit
        run: npm audit --audit-level=high
      
      - name: Run ESLint
        run: npx eslint . --ext .js,.jsx,.ts,.tsx
```

**Security Scanning Schedule**

- Run basic scans on every PR
- Run comprehensive scans nightly
- Run full security audit weekly
- Update scanning tools monthly

### Related Decisions

* [**ADR-0001** Primary Programming Language](adr-0001-primary-programming-language.md)
* [**ADR-0004** Release Management](adr-0004-release-management.md)
* [**ADR-0016** Security Architecture](adr-0016-security-architecture.md)